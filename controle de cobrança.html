<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de CobranÃ§a Pro - Oficial 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #0f172a; color: #f8fafc; overflow-x: hidden; }
        .bg-dark-blue { background-color: #1e293b; }
        .text-orange { color: #f97316; }
        .bg-orange { background-color: #f97316; }
        input, select, textarea { background-color: #0f172a !important; color: white !important; border: 1px solid #334155 !important; }
        #login-screen { position: fixed; inset: 0; background: #0f172a; display: flex; justify-content: center; align-items: center; z-index: 2000; }
        .row-vencido { background-color: rgba(239, 68, 68, 0.1); border-left: 4px solid #ef4444; }
        .row-alerta { background-color: rgba(234, 179, 8, 0.1); border-left: 4px solid #eab308; }
        
        /* Estilos da Sidebar RetrÃ¡til */
        #sidebar { transition: all 0.3s ease; width: 260px; min-width: 260px; }
        #sidebar.collapsed { width: 80px; min-width: 80px; }
        #sidebar.collapsed .sidebar-text { display: none; }
        #sidebar.collapsed .sidebar-logo { font-size: 0; }
        #sidebar.collapsed .sidebar-logo span { font-size: 1.2rem; }
        #sidebar.collapsed nav button { justify-content: center; padding: 12px 0; }
        #sidebar.collapsed nav button i { margin-right: 0; font-size: 1.2rem; }
    </style>
</head>
<body class="font-sans">

    <div id="login-screen">
        <div class="bg-white p-8 rounded-xl w-80 text-slate-900 shadow-2xl text-center">
            <h2 class="font-bold text-xl mb-4 text-orange italic uppercase">Painel de CobranÃ§a</h2>
            <input type="email" id="loginEmail" placeholder="E-mail" class="w-full p-2 border rounded mb-3 outline-none">
            <input type="password" id="loginPass" placeholder="Senha" class="w-full p-2 border rounded mb-4 outline-none">
            <button id="btnLogin" class="w-full bg-orange text-white font-bold py-2 rounded uppercase italic">Entrar</button>
        </div>
    </div>

    <div id="app-content" class="flex min-h-screen" style="display:none;">
        
        <aside id="sidebar" class="bg-dark-blue p-4 border-r border-gray-700 flex flex-col text-sm font-bold relative">
            <div class="flex items-center justify-between mb-10 px-2">
                <div class="sidebar-logo text-orange italic text-xl uppercase tracking-tighter">
                    Sistema <span class="text-white">C</span><span class="text-white sidebar-text">obranÃ§a</span>
                </div>
                <button onclick="toggleSidebar()" class="text-gray-400 hover:text-orange transition">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
            
            <nav class="space-y-4">
                <button onclick="renderizarTabela()" class="w-full flex items-center p-3 rounded bg-orange text-white">
                    <i class="fas fa-home w-6"></i> 
                    <span class="sidebar-text">Dashboard</span>
                </button>
                <button onclick="openModal('modalAluno')" class="w-full flex items-center p-3 rounded hover:bg-slate-700 transition">
                    <i class="fas fa-plus w-6"></i> 
                    <span class="sidebar-text">Novo Aluno</span>
                </button>
            </nav>

            <div class="mt-auto p-2 sidebar-text text-[10px] text-gray-500 uppercase font-black text-center border-t border-gray-800 pt-4">
                v2.1 Financeiro
            </div>
        </aside>

        <main class="flex-1 p-8 overflow-hidden flex flex-col">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 text-center">
                <div class="bg-dark-blue p-4 rounded-lg border-b-4 border-orange"><p class="text-gray-400 text-[10px] uppercase font-bold">Total</p><h3 id="cardTotal" class="text-2xl font-black text-orange">0</h3></div>
                <div class="bg-dark-blue p-4 rounded-lg border-b-4 border-red-600"><p class="text-gray-400 text-[10px] uppercase font-bold">ðŸ”´ Vencidos</p><h3 id="cardVencidos" class="text-2xl font-black text-red-500">0</h3></div>
                <div class="bg-dark-blue p-4 rounded-lg border-b-4 border-yellow-500"><p class="text-gray-400 text-[10px] uppercase font-bold">ðŸŸ¡ Alerta</p><h3 id="cardAlerta" class="text-2xl font-black text-yellow-400">0</h3></div>
                <div class="bg-dark-blue p-4 rounded-lg border-b-4 border-green-500"><p class="text-gray-400 text-[10px] uppercase font-bold">ðŸŸ¢ Em Dia</p><h3 id="cardEmDia" class="text-2xl font-black text-green-500">0</h3></div>
            </div>

            <div class="bg-slate-800/50 p-4 rounded-t-lg border border-gray-700 grid grid-cols-1 md:grid-cols-4 gap-4">
                <input type="text" id="buscaGeral" onkeyup="renderizarTabela()" placeholder="Buscar Nome ou CPF..." class="p-2 rounded text-sm outline-none">
                <select id="filtroUnidade" onchange="renderizarTabela()" class="p-2 rounded text-sm outline-none">
                    <option value="Todas">Todas Unidades</option>
                    <option value="Recife">Recife</option><option value="Carpina">Carpina</option>
                    <option value="GravatÃ¡">GravatÃ¡</option><option value="Bezerros">Bezerros</option>
                    <option value="Amaraji">Amaraji</option>
                </select>
                <select id="filtroTipo" onchange="renderizarTabela()" class="p-2 rounded text-sm outline-none">
                    <option value="Todos">Todos (PTC/EXT)</option>
                    <option value="PTC">PTC</option><option value="Extranet">Extranet</option>
                </select>
                <select id="filtroStatusFin" onchange="renderizarTabela()" class="p-2 rounded text-sm outline-none">
                    <option value="Todos">Todas SituaÃ§Ãµes</option>
                    <option value="Vencido">ðŸ”´ Vencidos</option><option value="Alerta">ðŸŸ¡ Alerta</option><option value="EmDia">ðŸŸ¢ Em Dia</option>
                </select>
            </div>

            <div class="bg-dark-blue border-x border-b border-gray-700 rounded-b-lg overflow-auto">
                <table class="w-full text-left">
                    <thead class="bg-slate-800 text-[10px] uppercase text-gray-400 font-black">
                        <tr>
                            <th class="p-4">Aluno / Detalhes</th>
                            <th class="p-4">Parcelas</th>
                            <th class="p-4">Vencimento</th>
                            <th class="p-4 text-center">AÃ§Ãµes</th>
                        </tr>
                    </thead>
                    <tbody id="listaAlunos" class="divide-y divide-gray-800 text-sm"></tbody>
                </table>
            </div>
        </main>
    </div>

    <div id="modalAluno" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center p-4 z-50">
        <div class="bg-dark-blue w-full max-w-md p-6 rounded-lg border border-gray-700 shadow-2xl">
            <h2 class="text-xl font-bold text-orange mb-4 italic uppercase">Cadastrar Aluno</h2>
            <div class="space-y-4">
                <input type="text" id="novoNome" placeholder="Nome Completo" class="w-full p-2 rounded uppercase font-bold outline-none">
                <input type="text" id="novoCpf" placeholder="CPF" oninput="maskCPF(this)" maxlength="14" class="w-full p-2 rounded outline-none">
                <input type="text" id="novoTel" placeholder="WhatsApp" oninput="maskTel(this)" maxlength="15" class="w-full p-2 rounded outline-none">
                <div class="grid grid-cols-2 gap-4">
                    <select id="novoUnidade" class="p-2 rounded outline-none">
                        <option value="Recife">Recife</option><option value="Carpina">Carpina</option>
                        <option value="GravatÃ¡">GravatÃ¡</option><option value="Bezerros">Bezerros</option>
                        <option value="Amaraji">Amaraji</option>
                    </select>
                    <select id="novoTipo" class="p-2 rounded outline-none">
                        <option value="PTC">PTC</option><option value="Extranet">Extranet</option>
                    </select>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button onclick="closeModal('modalAluno')" class="text-gray-400 font-bold">Cancelar</button>
                    <button onclick="salvarNovoAluno()" class="bg-orange px-6 py-2 rounded font-black text-white uppercase text-sm">Salvar Aluno</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modalAcordo" class="fixed inset-0 bg-black/80 hidden flex items-center justify-center p-4 z-50">
        <div class="bg-dark-blue w-full max-w-4xl p-8 rounded-lg border-2 border-orange shadow-2xl">
            <h2 class="text-2xl font-black text-orange mb-1 italic uppercase">Configurar Acordo & Proposta</h2>
            <p id="nomeAlunoAcordo" class="text-sm text-gray-400 mb-8 uppercase font-bold"></p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <div class="space-y-5">
                    <div>
                        <label class="text-[10px] text-gray-400 font-black uppercase mb-1 block">DescriÃ§Ã£o da CobranÃ§a</label>
                        <textarea id="descricaoDebito" placeholder="Ex: Mensalidades atrasadas + RematrÃ­cula" class="w-full p-3 rounded text-sm outline-none h-20"></textarea>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-[10px] text-gray-400 font-black uppercase mb-1 block">Valor Total Bruto</label>
                            <input type="text" id="valorTotalBruto" onkeyup="maskDinheiro(this)" placeholder="R$ 0,00" class="w-full p-3 rounded text-sm outline-none">
                        </div>
                        <div>
                            <label class="text-[10px] text-green-400 font-black uppercase mb-1 block">Valor PIX (Ã€ Vista)</label>
                            <input type="text" id="valorAVista" onkeyup="maskDinheiro(this)" placeholder="R$ 0,00" class="w-full p-3 rounded text-sm text-green-400 font-bold outline-none">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-[10px] text-gray-400 font-black uppercase mb-1 block">Entrada (Boleto)</label>
                            <input type="text" id="entrada" onkeyup="maskDinheiro(this)" placeholder="R$ 0,00" class="w-full p-3 rounded text-sm outline-none">
                        </div>
                        <div>
                            <label class="text-[10px] text-gray-400 font-black uppercase mb-1 block">Valor Parcela</label>
                            <input type="text" id="vlrParcelaManual" onkeyup="maskDinheiro(this)" placeholder="R$ 0,00" class="w-full p-3 rounded text-sm outline-none">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-[10px] text-gray-400 font-black uppercase mb-1 block">Total de Parcelas</label>
                            <input type="number" id="numParcelas" class="w-full p-3 rounded text-sm outline-none">
                        </div>
                        <div>
                            <label class="text-[10px] text-gray-400 font-black uppercase mb-1 block">Parcelas JÃ¡ Pagas</label>
                            <input type="number" id="parcelaAtualManual" class="w-full p-3 rounded text-sm border-orange/40 outline-none">
                        </div>
                    </div>

                    <div>
                        <label class="text-[10px] text-orange font-black uppercase mb-1 block">Vencimento da 1Âª Parcela (ou Entrada)</label>
                        <input type="date" id="dataVencimentoManual" class="w-full p-3 rounded text-sm outline-none">
                    </div>
                </div>

                <div class="flex flex-col justify-between">
                    <div class="bg-slate-900/50 p-6 rounded-xl border border-gray-700 h-full">
                        <div class="mb-6">
                            <label class="text-[10px] text-orange font-black uppercase block mb-3">Tom da Mensagem</label>
                            <select id="tomMensagem" class="w-full p-3 rounded text-sm outline-none">
                                <option value="motivado">âœ¨ Motivacional (Sonho/RematrÃ­cula)</option>
                                <option value="padrao" selected>ðŸ“„ PadrÃ£o Persuasivo (Profissional)</option>
                            </select>
                        </div>
                        <div class="space-y-4">
                            <p class="text-orange font-bold text-sm uppercase">Dica de AtualizaÃ§Ã£o:</p>
                            <p class="text-xs text-gray-400 leading-relaxed">Se o aluno pagou 7 de 9, coloque "7" em Pagas. O sistema moverÃ¡ o vencimento para a parcela 8 automaticamente.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-between items-center mt-10">
                <button onclick="closeModal('modalAcordo')" class="text-gray-400 font-bold hover:text-white transition">Cancelar</button>
                <div class="flex gap-4">
                    <button onclick="salvarAcordo(false)" class="bg-slate-700 px-8 py-3 rounded font-black text-white uppercase text-xs">Apenas Salvar</button>
                    <button onclick="salvarAcordo(true)" class="bg-orange px-10 py-3 rounded font-black text-white uppercase text-xs shadow-lg">Salvar e Enviar Proposta</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, onSnapshot, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyC4_dlIiCaNHtj7eWB4kW200vnO6AuuuTA", 
            authDomain: "reguacobranca.firebaseapp.com", 
            projectId: "reguacobranca", 
            storageBucket: "reguacobranca.firebasestorage.app", 
            messagingSenderId: "85201788796", 
            appId: "1:85201788796:web:25cf11a726cec89d248ef9" 
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const colRef = collection(db, "negociacoes");

        window.db_local = [];
        window.idAtivo = null;

        onAuthStateChanged(auth, user => {
            if (user) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-content').style.display = 'flex';
                ouvirBanco();
            }
        });

        function ouvirBanco() {
            onSnapshot(colRef, (snapshot) => {
                window.db_local = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderizarTabela();
            });
        }

        window.toggleSidebar = () => {
            const sb = document.getElementById('sidebar');
            sb.classList.toggle('collapsed');
        };

        window.renderizarTabela = () => {
            const lista = document.getElementById('listaAlunos');
            const busca = document.getElementById('buscaGeral').value.toUpperCase();
            const fUni = document.getElementById('filtroUnidade').value;
            const fTipo = document.getElementById('filtroTipo').value;
            const fFin = document.getElementById('filtroStatusFin').value;
            
            lista.innerHTML = "";
            let tTotal=0, tVenc=0, tAlert=0, tDia=0;
            const hoje = new Date(); hoje.setHours(0,0,0,0);

            const filtrados = [...window.db_local]
                .sort((a, b) => a.nome.localeCompare(b.nome))
                .filter(a => {
                    let status = "EmDia";
                    if(a.fin?.venc) {
                        const [d, m, y] = a.fin.venc.split('/');
                        const dVenc = new Date(y, m - 1, d);
                        const diff = Math.ceil((dVenc - hoje) / (1000 * 60 * 60 * 24));
                        if(diff < 0) status = "Vencido";
                        else if(diff <= 5) status = "Alerta";
                    }
                    const mBusca = !busca || a.nome.includes(busca) || a.cpf.includes(busca);
                    const mUni = fUni === "Todas" || a.unidade === fUni;
                    const mTipo = fTipo === "Todos" || a.tipo === fTipo;
                    if(mBusca && mUni && mTipo) {
                        tTotal++;
                        if(status === "Vencido") tVenc++; else if(status === "Alerta") tAlert++; else tDia++;
                    }
                    return mBusca && mUni && mTipo && (fFin === "Todos" || status === fFin);
                });

            filtrados.forEach((a) => {
                let sClass = "";
                if(a.fin?.venc) {
                    const [d, m, y] = a.fin.venc.split('/');
                    const dVenc = new Date(y, m - 1, d);
                    const diff = Math.ceil((dVenc - hoje) / (1000 * 60 * 60 * 24));
                    sClass = diff < 0 ? "row-vencido" : (diff <= 5 ? "row-alerta" : "");
                }
                lista.innerHTML += `
                    <tr class="hover:bg-slate-800 border-b border-gray-800 ${sClass}">
                        <td class="p-4">
                            <div class="font-bold text-[12px] uppercase">${a.nome}</div>
                            <div class="text-[9px] text-gray-500 font-black">${a.unidade} | ${a.cpf} | <span class="text-orange">${a.tipo || '---'}</span></div>
                        </td>
                        <td class="p-4 font-bold text-orange">${a.parcelaAtual || 0}/${a.fin?.totalParcelas || 0}</td>
                        <td class="p-4 font-mono text-xs">${a.fin?.venc || '---'}</td>
                        <td class="p-4 flex justify-center gap-4 text-lg">
                            <button onclick="enviarCobrancaMensal('${a.id}')" class="text-blue-400"><i class="fas fa-paper-plane"></i></button>
                            <button onclick="prepararAcordo('${a.id}')" class="text-gray-500"><i class="fas fa-edit"></i></button>
                            <button onclick="excluirAluno('${a.id}')" class="text-red-900"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>`;
            });
            document.getElementById('cardTotal').innerText = tTotal;
            document.getElementById('cardVencidos').innerText = tVenc;
            document.getElementById('cardAlerta').innerText = tAlert;
            document.getElementById('cardEmDia').innerText = tDia;
        };

        window.prepararAcordo = (id) => {
            window.idAtivo = id;
            const a = window.db_local.find(al => al.id === id);
            if(!a) return;
            document.getElementById('nomeAlunoAcordo').innerText = a.nome;
            document.getElementById('descricaoDebito').value = a.fin?.descricao || '';
            document.getElementById('valorTotalBruto').value = a.fin?.valorTotalBruto || '';
            document.getElementById('valorAVista').value = a.fin?.valorAVista || '';
            document.getElementById('entrada').value = a.fin?.valorEntrada || '';
            document.getElementById('vlrParcelaManual').value = a.fin?.valorParcela || '';
            document.getElementById('numParcelas').value = a.fin?.totalParcelas || '';
            document.getElementById('parcelaAtualManual').value = a.parcelaAtual || 0;
            openModal('modalAcordo');
        };

        window.salvarAcordo = async (enviar) => {
            const a = window.db_local.find(al => al.id === window.idAtivo);
            const pAtu = parseInt(document.getElementById('parcelaAtualManual').value) || 0;
            const dataIni = document.getElementById('dataVencimentoManual').value;
            let dataObj = dataIni ? new Date(dataIni + "T12:00:00") : new Date();
            if(pAtu > 0) dataObj.setMonth(dataObj.getMonth() + pAtu);
            const vencFinal = dataObj.toLocaleDateString('pt-BR');

            const info = {
                venc: vencFinal,
                valorParcela: document.getElementById('vlrParcelaManual').value,
                totalParcelas: parseInt(document.getElementById('numParcelas').value) || 0,
                valorEntrada: document.getElementById('entrada').value,
                valorTotalBruto: document.getElementById('valorTotalBruto').value,
                valorAVista: document.getElementById('valorAVista').value,
                descricao: document.getElementById('descricaoDebito').value
            };

            await updateDoc(doc(db, "negociacoes", a.id), { parcelaAtual: pAtu, fin: info });
            closeModal('modalAcordo');

            if(enviar) {
                const tom = document.getElementById('tomMensagem').value;
                let msg = "";
                if(tom === "motivado") {
                    msg = `OlÃ¡, *${a.nome}*! ðŸ‘‹\n\nSou da equipe financeira da *${a.unidade}* e estou passando com uma notÃ­cia importante!\n\nOlhando aqui sua trajetÃ³ria, vi que falta pouco para vocÃª dar o prÃ³ximo passo na sua carreira. NÃ£o queremos que nada interrompa o seu sonho de conquistar seu diploma! ðŸŽ“âœ¨\n\nPreparamos uma condiÃ§Ã£o exclusiva para vocÃª zerar sua pendÃªncia financeira de *${info.descricao}* e jÃ¡ garantir sua *REMATRÃCULA* para o prÃ³ximo semestre. ðŸš€\n\nâœ… *Oportunidade Ãšnica:*\nâ€¢ *Ã€ vista no PIX (com desconto):* ${info.valorAVista} (pode ser parcelado no cartÃ£o de crÃ©dito em atÃ© 12x iguais)\nâ€¢ *Parcelado no Boleto:* Entrada de ${info.valorEntrada} + ${info.totalParcelas}x de ${info.valorParcela}\n\nVamos garantir sua vaga e continuar essa jornada juntos? Me avisa aqui qual opÃ§Ã£o fica melhor para vocÃª!`;
                } else {
                    msg = `OlÃ¡, *${a.nome}*! ðŸ‘‹ \n\nSou da equipe de regularizaÃ§Ã£o financeira da *${a.unidade}*.\n\nIdentificamos uma pendÃªncia em aberto referente a *${info.descricao}* e preparamos uma proposta especial para facilitar a atualizaÃ§Ã£o da sua situaÃ§Ã£o conosco. Nosso objetivo Ã© oferecer flexibilidade para que vocÃª mantenha seu histÃ³rico regularizado:\n\nðŸ’° *OpÃ§Ã£o Ã  Vista (PIX):* ${info.valorAVista}\nðŸ“„ *Plano Parcelado:* Entrada de ${info.valorEntrada} + ${info.totalParcelas}x de ${info.valorParcela}\n\nAcreditamos que uma dessas opÃ§Ãµes se encaixa no seu planejamento atual. Qual delas fica melhor para vocÃª? \n\nCaso tenha alguma dÃºvida ou precise de um plano diferente, estamos Ã  disposiÃ§Ã£o para conversar e encontrar a melhor soluÃ§Ã£o!`;
                }
                window.open(`https://api.whatsapp.com/send?phone=55${a.tel.replace(/\D/g,'')}&text=${encodeURIComponent(msg)}`);
            }
        };

        window.enviarCobrancaMensal = async (id) => {
            const a = window.db_local.find(al => al.id === id);
            if (!a.fin) return alert("Configure o acordo primeiro!");
            const prox = (a.parcelaAtual || 0) + 1;
            if (confirm(`AvanÃ§ar para parcela ${prox}?`)) {
                const parts = a.fin.venc.split('/');
                const d = new Date(parts[2], parts[1] - 1, parts[0]);
                d.setMonth(d.getMonth() + 1);
                const novaData = d.toLocaleDateString('pt-BR');
                await updateDoc(doc(db, "negociacoes", a.id), { parcelaAtual: prox, "fin.venc": novaData });
                const msg = `OlÃ¡, *${a.nome}*! ðŸ‘‹\n\nSegue o boleto referente Ã  parcela *${prox}/${a.fin.totalParcelas}* (*${a.unidade}*).\n\nðŸ’° *Valor:* ${prox === 1 ? a.fin.valorEntrada : a.fin.valorParcela}\nðŸ“… *Vencimento:* ${a.fin.venc}\n\nVocÃª pode acompanhar seu financeiro e baixar os boletos atualizados diretamente no nosso portal:\nðŸŒ https://www.vaiqta.com.br/\n\nO boleto tambÃ©m segue em anexo abaixo. Qualquer dÃºvida, estamos Ã  disposiÃ§Ã£o!`;
                window.open(`https://api.whatsapp.com/send?phone=55${a.tel.replace(/\D/g,'')}&text=${encodeURIComponent(msg)}`);
            }
        };

        window.salvarNovoAluno = async () => {
            const cpf = document.getElementById('novoCpf').value.replace(/\D/g, '');
            if(!cpf) return alert("CPF obrigatÃ³rio");
            await setDoc(doc(db, "negociacoes", cpf), {
                nome: document.getElementById('novoNome').value.toUpperCase(),
                cpf: document.getElementById('novoCpf').value,
                tel: document.getElementById('novoTel').value,
                unidade: document.getElementById('novoUnidade').value,
                tipo: document.getElementById('novoTipo').value,
                parcelaAtual: 0
            });
            closeModal('modalAluno');
        };

        window.excluirAluno = async (id) => { if(confirm("Excluir definitivamente?")) await deleteDoc(doc(db, "negociacoes", id)); };
        window.openModal = (id) => document.getElementById(id).classList.remove('hidden');
        window.closeModal = (id) => document.getElementById(id).classList.add('hidden');
        window.maskCPF = (i) => { let v = i.value.replace(/\D/g, ""); v = v.replace(/(\d{3})(\d)/, "$1.$2"); v = v.replace(/(\d{3})(\d)/, "$1.$2"); v = v.replace(/(\d{3})(\d{1,2})$/, "$1-$2"); i.value = v; };
        window.maskTel = (i) => { let v = i.value.replace(/\D/g, ""); v = v.replace(/^(\d{2})(\d)/g, "($1) $2"); v = v.replace(/(\d)(\d{4})$/, "$1-$2"); i.value = v; };
        window.maskDinheiro = (i) => { let v = i.value.replace(/\D/g,''); v = (v/100).toFixed(2) + ''; v = v.replace(".", ","); v = v.replace(/(\d)(\d{3}),/g, "$1.$2,"); i.value = "R$ " + v; };

        document.getElementById('btnLogin').onclick = async () => {
            const e = document.getElementById('loginEmail').value;
            const p = document.getElementById('loginPass').value;
            try { await signInWithEmailAndPassword(auth, e, p); } catch(e) { alert("Credenciais InvÃ¡lidas"); }
        };
    </script>
</body>
</html>
